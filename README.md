# Сервис для работы с контентом пользователей кинотеатра: лайками, закладками, рецензиями

## Первый запуск:

1. Создать файл .env:

```bash
cp .env.example .env
```

Изменить значения переменных, если это необходимо 2. Запустить базу данных:

```bash
make run-mongo
```

Подождать несколько секунд, пока база данных запустится. 3. Запустить инициализацию шардов и настройки репликации:

```bash
make init-db
```

4. Запустить создание пользователя БД:

```bash
make create-dbuser
```

5. Запустить API-сервис:

```bash
make run-api
```

## Обычный запуск

После первого запуска можно запускать все контейнеры командой:

```bash
make run-all
```

## Выполнение запросов

Документация swagger находится по адресу http://127.0.0.1/api-ugc/openapi

Для выполнения некоторых запросов необходимо быть авторизованным пользователем.
Для генерации access-токена можно использовать python-скрипт:

```bash
python tools/generate_token.py
```

## Подключение Sentry

Укажите в .env SENTRY_DSN актуальный [DSN](https://docs.sentry.io/concepts/key-terms/dsn-explainer/)

Для локального размещения

```bash
# Поднимаем Sentry и создаем пользователя
make sentry-up
```

После применения миграций переходим по адресу
http://localhost:9000/
создаем проект и забираем DSN

Перезапускаем проект

## Разработка

### Pre-commit хуки

Для установки pre-commit хуков выполните:

```bash
pip install pre-commit
pre-commit install
```

Это установит автоматические проверки кода перед каждым коммитом, включая:
- Проверку форматирования (trailing whitespace, end of file)
- Проверку синтаксиса YAML
- Проверку конфликтов слияния
- Линтинг с помощью flake8
- Сортировку импортов с помощью isort
- Форматирование и линтинг с помощью ruff
- Проверку типов с помощью mypy
